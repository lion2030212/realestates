<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة مصروفات العقار</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <h2>إدارة صندوق العقار</h2>
            <form id="login-form">
                <div class="input-group">
                    <label for="username">اسم المستخدم:</label>
                    <input type="text" id="username" required>
                </div>
                <div class="input-group">
                    <label for="password">كلمة المرور:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="submit-btn modern-btn">دخول</button>
                <p id="error-message" class="error-message"></p>
            </form>
        </div>
        <div class="login-footer">
            <p>Power by Al Rashdan</p>
        </div>
    </div>

    <div id="main-app" class="container hidden">
        <header class="app-header">
            <div class="header-right">
                <i class="fas fa-home home-icon"></i>
                <span id="user-greeting">مرحبا، </span>
            </div>
            <div class="header-left">
                <div class="message-container">
                    <i id="notifications-btn" class="fas fa-user-shield notification-icon hidden"></i>
                    <span id="notification-badge" class="notification-badge hidden">0</span>
                </div>
                <i id="logout-btn" class="fas fa-sign-out-alt logout-icon"></i>
            </div>
        </header>
        
        <div class="sidebar-toggle-container">
            <i id="sidebar-toggle-btn" class="fas fa-bars sidebar-toggle-btn"></i>
        </div>

        <div id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>القائمة الرئيسية</h3>
                <i id="sidebar-close-btn" class="fas fa-times"></i>
            </div>
            <ul class="sidebar-menu">
                <li id="manage-users-btn" class="menu-item hidden">
                    <i class="fas fa-users-cog"></i>
                    <span>إدارة المستخدمين</span>
                </li>
                <li id="permissions-btn" class="menu-item hidden">
                    <i class="fas fa-user-shield"></i>
                    <span>المعاملات المعتمدة</span>
                </li>
                <li class="menu-item"><i class="fas fa-chart-bar"></i><span>الإحصائيات</span></li>
                <li class="menu-item"><i class="fas fa-file-alt"></i><span>التقارير</span></li>
                <li id="backup-btn" class="menu-item hidden"><i class="fas fa-database"></i><span>نسخ احتياطي</span></li>
            </ul>
        </div>
        
        <div class="content-wrapper">
            <div class="dashboard-header">
                <div class="summary-cards-container">
                    <div class="summary-card income">
                        <p><i class="fas fa-arrow-up"></i> إجمالي الدخل</p>
                        <span id="total-income">0.00</span>
                    </div>
                    <div class="summary-card expense">
                        <p><i class="fas fa-arrow-down"></i> إجمالي المصروفات</p>
                        <span id="total-expenses">0.00</span>
                    </div>
                    <div class="summary-card balance">
                        <p><i class="fas fa-balance-scale"></i> الرصيد</p>
                        <span id="balance">0.00</span>
                    </div>
                </div>

                <div class="actions">
                    <button id="add-income-btn" class="action-btn income-btn hidden">
                        <i class="fas fa-plus"></i> إضافة دخل
                    </button>
                    <button id="add-expense-btn" class="action-btn expense-btn hidden">
                        <i class="fas fa-minus"></i> إضافة مصروف
                    </button>
                </div>
            </div>

            <div class="chart-section card">
                <div class="chart-header">
                    <h2>الرسم البياني</h2>
                    <div class="chart-menu-container">
                        <i class="fas fa-ellipsis-v chart-menu-btn"></i>
                        <div class="chart-options hidden">
                            <span id="chart-filter-monthly">شهري</span>
                            <span id="chart-filter-yearly">سنوي</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                     <canvas id="myChart"></canvas>
                </div>
            </div>
            
            <div class="transactions-section card">
                <div class="transactions-header">
                    <h2>سجل المعاملات</h2>
                    <div class="transactions-header-right">
                         <div class="filter-box">
                            <label for="duration-filter">عرض حسب:</label>
                            <select id="duration-filter">
                                <option value="today">يومي</option>
                                <option value="current-month">الشهر الحالي</option>
                                <option value="last-month">الشهر الماضي</option>
                                <option value="current-year">السنة الحالية</option>
                                <option value="last-year">السنة الماضية</option>
                            </select>
                        </div>
                        <div class="search-btn-container">
                            <i id="advanced-search-btn" class="fas fa-search search-icon"></i>
                            <span id="search-active-badge" class="search-active-badge hidden"></span>
                        </div>
                    </div>
                </div>
                
                <div id="transactions-container">
                    </div>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3 id="modal-title"></h3>
            <form id="transaction-form">
                <input type="hidden" id="transaction-type">
                <input type="hidden" id="transaction-id">
                
                <label for="date">التاريخ:</label>
                <input type="date" id="date" required>

                <label for="category">التصنيف:</label>
                <input type="text" id="category" required>

                <label for="amount">المبلغ:</label>
                <input type="number" id="amount" required min="0.01" step="0.01">

                <label for="from-to">من/إلى:</label>
                <input type="text" id="from-to">

                <label for="note">ملاحظة:</label>
                <input type="text" id="note">

                <button type="submit" class="submit-btn">إضافة</button>
            </form>
        </div>
    </div>
    
    <div id="users-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>إدارة المستخدمين</h3>
            <div id="users-list-container">
                </div>
            <form id="add-user-form" class="hidden">
                <h4>إضافة مستخدم جديد</h4>
                <input type="hidden" id="new-user-id">
                <label for="new-user-role">الدور:</label>
                <select id="new-user-role" required>
                    <option value="manager">مدير النظام</option>
                    <option value="admin">مشرف محترف</option>
                    <option value="editor">مشرف</option>
                    <option value="employee">موظف محترف</option>
                    <option value="new_employee">موظف</option>
                    <option value="viewer">القارئ</option>
                </select>
                <label for="new-username">اسم المستخدم:</label>
                <input type="text" id="new-username" required>
                <label for="new-password">كلمة المرور:</label>
                <input type="password" id="new-password" required>
                <label for="new-user-description">الوصف:</label>
                <input type="text" id="new-user-description">
                <button type="submit" class="submit-btn" id="save-user-btn">إضافة</button>
            </form>
            <button id="show-add-user-form" class="action-btn primary-btn"><i class="fas fa-plus"></i> إضافة مستخدم جديد</button>
        </div>
    </div>

    <div id="messages-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>المعاملات بانتظار الموافقة</h3>
            <div id="pending-transactions-container">
                <p id="no-pending-transactions" class="hidden">لا توجد معاملات بانتظار الموافقة حالياً.</p>
            </div>
        </div>
    </div>
    
    <div id="permissions-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>المعاملات المعتمدة</h3>
            <div id="approved-transactions-container">
                <p id="no-approved-transactions" class="hidden">لا توجد معاملات معتمدة.</p>
            </div>
        </div>
    </div>

    <div id="backup-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>النسخ الاحتياطي والاستعادة</h3>
            <div class="backup-options-container">
                <div class="backup-section">
                    <h4><i class="fas fa-download"></i> إنشاء نسخة احتياطية</h4>
                    <p>قم بتنزيل ملف يحتوي على جميع بيانات التطبيق (المستخدمين والمعاملات).</p>
                    <button id="create-backup-btn" class="action-btn primary-btn">تنزيل النسخة الاحتياطية</button>
                </div>
                <div class="restore-section">
                    <h4><i class="fas fa-upload"></i> استعادة نسخة احتياطية</h4>
                    <p>اختر ملف نسخة احتياطية لاستعادة البيانات. سيتم استبدال جميع البيانات الحالية.</p>
                    <input type="file" id="restore-backup-input" accept=".json" class="hidden">
                    <label for="restore-backup-input" class="action-btn income-btn">اختر ملف</label>
                    <span id="file-name-display">لم يتم اختيار أي ملف.</span>
                </div>
            </div>
        </div>
    </div>

    <div id="advanced-search-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>بحث متقدم</h3>
            <form id="advanced-search-form">
                <div class="input-group">
                    <label for="search-type">نوع المعاملة:</label>
                    <select id="search-type">
                        <option value="">الكل</option>
                        <option value="income">دخل</option>
                        <option value="expense">مصروف</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="search-category">التصنيف:</label>
                    <input type="text" id="search-category">
                </div>
                <div class="input-group">
                    <label for="search-note">ملاحظة:</label>
                    <input type="text" id="search-note">
                </div>
                <div class="input-group">
                    <label for="search-from-to">من/إلى:</label>
                    <input type="text" id="search-from-to">
                </div>
                <div class="input-group manager-only hidden">
                    <label for="search-username">اسم المستخدم:</label>
                    <input type="text" id="search-username">
                </div>
                <div class="input-group">
                    <label for="search-from-date">من تاريخ:</label>
                    <input type="date" id="search-from-date">
                </div>
                <div class="input-group">
                    <label for="search-to-date">إلى تاريخ:</label>
                    <input type="date" id="search-to-date">
                </div>
                
                <div class="search-buttons-container">
                    <button type="submit" class="submit-btn">بحث</button>
                    <button type="button" class="submit-btn secondary-btn" id="clear-search-btn">مسح</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>
